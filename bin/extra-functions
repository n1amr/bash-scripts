#!/bin/bash

keybindings () {
    less "$DOTFILES_HOME/config/keybindings.$SHELLNAME"
}

bak () {
    while [ $# != 0 ]; do
        cp -ir "$1" "$1.bak.$(date +%s)"
        shift
    done
}

cdf () {
    diff -u "$1" "$2" | colordiff | less -FRX
}

cdtree () {
    cd "${@:-.}" || return
    tree -CL 1 --dirsfirst "$(realpath .)" | nl | less -FRX
}

findword () {
    grep -P "$1" /usr/share/dict/words
}

hcd () {
    history | grep -P "\d+\s+cd $*"
}

json() {
    if [ -t 0 ]; then # argument
         python -m json.tool <<< "$*" | pygmentize -l json;
    else # pipe
         python -m json.tool | pygmentize -l json;
    fi;
}

linerange() {
    head -"$2" | tail -n +"$1"
}

print_pdf_counts () {
    DELIM=';.;.;'
    # shellcheck disable=SC2016,SC2048,SC2086
    [ $# -ne 0 ] && exiftool -n -q -p '${PageCount}'"$DELIM"'${PageCount;our $sum; $_=($sum+=$_)}'"$DELIM"'${FileName}' $* 2> /dev/null \
    | awk -F "$DELIM" '{sum=$2;$2=":"; print $0} END{print "===============\nTotal: ", sum}'
}

print_videos_duration () {
    DELIM=';.;.;'
    # shellcheck disable=SC2016,SC2048,SC2086
    [ $# -ne 0 ] && exiftool -n -q -p '${Duration; $_=ConvertDuration($_)}'"$DELIM"'${Duration;our $sum;$_=ConvertDuration($sum+=$_)}'"$DELIM"'${FileName}' $* 2> /dev/null \
    | awk -F "$DELIM" '{sum=$2;$2=""; print $0} END{print "===============\nTotal: ", sum}'
}

print_title_comment() {
    LENGTH=80
    if [ ${#1} -ge $LENGTH ]; then
        echo "### ${1} ###"
    elif [ ${#1} -eq 0 ]; then
        printf "%*s\n" $LENGTH "#" | tr ' ' '#'
    else
        printf "%*s%*s\n" $(( (${#1} + 4 + LENGTH) / 2)) "__${1// /$}__" $(( LENGTH - (${#1} + 4 + LENGTH) / 2)) "#" | tr ' _$' '#  '
    fi
}

sum_videos_duration () {
    # shellcheck disable=SC2068
    print_videos_duration $@ | tail -1 | awk '{print $2}'
}

up () {
    # shellcheck disable=SC2051
    cd "$(printf '../%.0s' {1.."$1"})" || return
}
