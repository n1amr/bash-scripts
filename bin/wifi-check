#!/bin/bash

source ~/.dotfiles_config

WIFI_LIST_FILE="$DOTFILES_HOME/data/wifi-list"
[ -f "$WIFI_LIST_FILE" ] || echo "# Enter wifi SSID list here" > "$WIFI_LIST_FILE"

state() {
    nmcli d | grep wlp8s0 | grep -Po '\S*connected'
}

while IFS= read -r line; do
    [ "$(state)" = "connected" ] && break
    id="$(echo "$line" | grep -Po '^[^#].*')"
    [ $? = 0 ] || continue
    echo "connecting to $id..."
    timeout 5s nmcli connection up id "$id"
done < "$WIFI_LIST_FILE"
