#!/bin/bash

source ~/.dotfiles_config

WIFI_LIST_FILE="$DOTFILES_HOME/data/wifi-list"
[ -f "$WIFI_LIST_FILE" ] || echo "# Enter wifi SSID list here" > "$WIFI_LIST_FILE"

state() {
    nmcli d | grep wlp8s0 | grep -Po '\S*connected'
}

while IFS= read line; do
    [ "${#line}" = 0 -o "${line:0:1}" = "#" ] && continue  # ignore empty lines comments
    if [[ x"$(state)" == x"connected" ]]; then
        break
    fi
    echo "connecting to $id..."
    timeout 5s nmcli connection up id "$id"
done < "$WIFI_LIST_FILE"
