#!/bin/bash

[ -n "$DOTFILES_HELPERS" ] && return || export DOTFILES_HELPERS=true

source "$DOTFILES_HOME/bin/utils/log"

safe_link() {
    from="$1"
    to="$2"
    printf "Link %s -> %s ? ([y]/n) " "$from" "$to"
    read -r response

    if [ "$response" != 'n' ]; then
        if [ -e "$from" ]; then
            info "Moving \"$from\" to \"${from}.bak.$(date --utc +"%Y%m%d%H%M%S")\""
            echo mv "$from" "${from}.bak.$(date --utc +"%Y%m%d%H%M%S")"
            mv "$from" "${from}.bak.$(date --utc +"%Y%m%d%H%M%S")"
        fi

        dir="$(dirname "$from")"
        if [ ! -d "$dir" ]; then
            info "Created directory \"$dir\""
            mkdir -pv "$dir"
        fi

        ln -sf "$to" "$from"
    fi
}
