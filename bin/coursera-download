#!/bin/bash

source ~/.dotfiles_config
if [ -z "$DOTFILES_CONFIG_COURSERA_HOME" ]; then
    echo -n 'Enter coursera home directory: '
    read DOTFILES_CONFIG_COURSERA_HOME
    echo "export DOTFILES_CONFIG_COURSERA_HOME='$DOTFILES_CONFIG_COURSERA_HOME'" >> ~/.dotfiles_config
fi

COURSERA_HOME="$DOTFILES_CONFIG_COURSERA_HOME"
COURSES_LIST_FILE="$COURSERA_HOME/coursera-download-list.txt"

cd "$COURSERA_HOME"

mapfile -t courses < "$COURSES_LIST_FILE"

for course in "${courses[@]}"; do
    if echo "${course}" | grep -v '^\s*#' | grep -q '\S'; then
        echo "Downloading ${course} into \"$COURSERA_HOME/${course}\""
        coursera-dl --disable-url-skipping --resume --path "$COURSERA_HOME" -sl en "${course}" -n
    fi
done
